<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Grid UI – Tasks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      [contenteditable][data-placeholder]:empty:before {
        content: attr(data-placeholder);
        color: rgb(100 116 139);
      }
      [contenteditable].single-line { white-space: nowrap; overflow: hidden; display: block; }
      [contenteditable].single-line br { display: none; }
      [contenteditable].single-line * { display: inline; white-space: nowrap; }

      @keyframes popIn { from { transform: scale(0.97); opacity: 0; } to { transform: scale(1); opacity: 1; } }
      .menu-pop { animation: popIn 120ms ease-out; transform-origin: top left; }

      @keyframes flashNew { 0% { background-color: rgba(16,185,129,0.22); } 100% { background-color: transparent; } }
      .flash-new { animation: flashNew 900ms ease-out forwards; }
    </style>
  </head>
  <body class="bg-gradient-to-br from-slate-50 via-emerald-50 to-sky-50 min-h-screen text-slate-900">
    <div class="max-w-6xl mx-auto px-4 py-8">
      <div class="mb-5 rounded-xl p-5 bg-gradient-to-r from-emerald-600 via-teal-600 to-sky-600 text-white shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-semibold tracking-tight">Wedding Planning Todo List</h1>
            <p class="text-white/90 text-sm mt-1">Track tasks, due dates, and progress with quick sorting.</p>
          </div>
          <div class="flex items-center gap-2">
            <button id="addRowBtn" class="inline-flex items-center gap-2 rounded-md bg-white/95 text-emerald-700 px-3 py-2 text-sm font-medium shadow hover:bg-white active:translate-y-[1px]">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M12 5a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H6a1 1 0 110-2h5V6a1 1 0 011-1z"/></svg>
              Add task
            </button>
          </div>
        </div>
        <div class="mt-4 grid grid-cols-1 gap-3 md:grid-cols-2">
          <div class="relative">
            <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-emerald-800/80">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 104.5 4.5a7.5 7.5 0 0012.15 12.15z"/></svg>
            </span>
            <input id="searchInput" type="text" placeholder="Search tasks or notes" class="w-full rounded-md border border-white/30 bg-white/95 pl-10 pr-3 py-2 text-sm text-emerald-900 placeholder-emerald-900/70 shadow focus:outline-none focus:ring-2 focus:ring-white/60" />
          </div>
          <div>
            <select id="statusFilter" class="w-full rounded-md border border-white/30 bg-white/95 px-3 py-2 text-sm text-emerald-900 shadow focus:outline-none focus:ring-2 focus:ring-white/60">
              <option value="all">Filter: All</option>
              <option value="Not started">Filter: Not started</option>
              <option value="In progress">Filter: In progress</option>
              <option value="Done">Filter: Done</option>
            </select>
          </div>
          
        </div>
      </div>

      <div class="rounded-xl border border-slate-200 bg-white/90 shadow-xl backdrop-blur-sm">
        <div class="overflow-x-auto max-h-[70vh] overflow-y-auto rounded-xl">
        <table class="min-w-full border-collapse" id="taskTable">
          <thead class="text-left text-sm sticky top-0 z-10 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/70">
            <tr>
              <th class="px-4 py-3 font-semibold text-slate-700 align-middle select-none sticky top-0">
                <div class="flex items-center gap-1">
                  <span>To do</span>
                </div>
              </th>
              <th class="px-4 py-3 font-semibold text-slate-700 align-middle select-none sticky top-0">
                <button class="sort-header flex items-center gap-1 hover:text-emerald-700 transition-colors" data-key="due" data-type="date" aria-label="Sort by due date">
                  <span>Due date</span>
                  <span class="sort-indicator text-slate-400">↕</span>
                </button>
              </th>
              <th class="px-4 py-3 font-semibold text-slate-700 align-middle select-none sticky top-0">Progress</th>
              <th class="px-4 py-3 font-semibold text-slate-700 align-middle select-none sticky top-0">Notes</th>
              <th class="px-2 py-3 w-12"></th>
            </tr>
          </thead>
          <tbody id="tableBody" class="text-sm">
          
          </tbody>
          <tfoot>
            <tr>
              <td colspan="5" class="px-4 py-3 text-sm text-slate-500">
                <button id="addRowInline" class="inline-flex items-center gap-2 text-emerald-700 hover:text-emerald-800">
                  <span class="text-lg leading-none">+</span>
                  <span>Click + to add new task</span>
                </button>
              </td>
            </tr>
          </tfoot>
        </table>
        </div>
      </div>

      
      <button id="fabAdd" class="fixed bottom-6 right-6 rounded-full bg-emerald-600 text-white p-4 shadow-xl hover:bg-emerald-700 active:translate-y-[1px] focus:outline-none focus:ring-2 focus:ring-emerald-300">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M12 5a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H6a1 1 0 110-2h5V6a1 1 0 011-1z"/></svg>
      </button>
    </div>

    <template id="rowTemplate">
      <tr class="border-t border-slate-100 hover:bg-slate-50/60 odd:bg-white even:bg-slate-50/40 transition-colors">
        <td class="px-4 py-3 align-middle">
          <div contenteditable="true" class="single-line outline-none focus:ring-2 focus:ring-emerald-200 rounded px-1 transition-shadow"
               data-placeholder="Click to add task..."></div>
        </td>
        <td class="px-4 py-3 align-middle">
          <input type="date" class="due-input w-44 rounded border-slate-300 px-2 py-1 text-sm focus:border-emerald-500 focus:ring-emerald-500 transition-colors" />
        </td>
        <td class="px-4 py-3 align-middle">
          <div class="relative inline-block">
            <button type="button" class="status-badge inline-flex items-center gap-1 rounded-full px-3 py-1 text-sm font-semibold border transition-all shadow-sm hover:shadow ring-1 ring-inset">
              <span class="status-dot w-2.5 h-2.5 rounded-full"></span>
              <span class="status-text">Not started</span>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 opacity-60 ml-1">
                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
              </svg>
            </button>
            <div class="status-menu absolute left-0 mt-1 w-48 rounded-md border border-slate-200 bg-white shadow-lg hidden z-10">
              <button data-status="Not started" class="status-option block w-full text-left px-3 py-2 text-sm hover:bg-slate-50">Not started</button>
              <button data-status="In progress" class="status-option block w-full text-left px-3 py-2 text-sm hover:bg-slate-50">In progress</button>
              <button data-status="Done" class="status-option block w-full text-left px-3 py-2 text-sm hover:bg-slate-50">Done</button>
            </div>
          </div>
        </td>
        <td class="px-4 py-3 align-middle">
          <div contenteditable="true" class="single-line outline-none focus:ring-2 focus:ring-emerald-200 rounded px-1 transition-shadow"
               data-placeholder="Click to add notes..."></div>
        </td>
        <td class="px-2 py-3 align-middle text-right">
          <button class="delete-row text-rose-600 hover:text-rose-700 p-1 rounded-md hover:bg-rose-50 transition-colors" title="Delete row" aria-label="Delete row">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M6.225 4.811A2.25 2.25 0 018.22 3.75h7.56a2.25 2.25 0 012.0 1.061l.22.37H21a.75.75 0 010 1.5h-1.053l-1.115 12.264A2.25 2.25 0 0116.592 21H7.408a2.25 2.25 0 01-2.24-2.055L4.053 6.68H3a.75.75 0 010-1.5h2.0l.225-.369zM8.22 5.25a.75.75 0 00-.667.389l-.297.511h9.49l-.297-.51a.75.75 0 00-.667-.39H8.22zM9 9.75a.75.75 0 011.5 0v7.5a.75.75 0 01-1.5 0v-7.5zm4.5 0a.75.75 0 011.5 0v7.5a.75.75 0 01-1.5 0v-7.5z"/></svg>
          </button>
        </td>
      </tr>
    </template>

    <script>
      const tbody = document.getElementById('tableBody');
      const rowTemplate = document.getElementById('rowTemplate');

      
      const PROGRESS_ORDER = {
        'Not started': 0,
        'In progress': 1,
        'Done': 2,
      };

      
      const STORAGE_KEY = 'taskGridData_v1';

      function serializeRows() {
        return Array.from(tbody.querySelectorAll('tr')).map(tr => {
          return {
            title: tr.children[0].innerText.trim(),
            due: tr.children[1].querySelector('input')?.value || '',
            progress: tr.children[2].dataset.value || 'Not started',
            notes: tr.children[3].innerText.trim(),
          };
        });
      }

      function saveTasksToStorage() {
        const data = serializeRows();
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        } catch (e) {}
      }

      function readTasksFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return null;
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return null;
          return parsed;
        } catch (e) {
          return null;
        }
      }

      function restoreFromData(items) {
        tbody.innerHTML = '';
        items.forEach(item => {
          const tr = addRow({ title: item.title || '', due: item.due || '', notes: item.notes || '' });
          const badge = tr.querySelector('.status-badge');
          applyStatusStyles(badge, item.progress || 'Not started');
        });
      }

      let saveTimerId;
      function scheduleSave() {
        clearTimeout(saveTimerId);
        saveTimerId = setTimeout(saveTasksToStorage, 300);
      }

      function applyStatusStyles(badgeEl, status) {
        badgeEl.classList.remove(
          'bg-slate-100','text-slate-800','border-slate-200','ring-slate-200',
          'bg-blue-100','text-blue-800','border-blue-200','ring-blue-200',
          'bg-emerald-100','text-emerald-800','border-emerald-200','ring-emerald-200'
        );
        const dot = badgeEl.querySelector('.status-dot');
        dot.classList.remove('bg-slate-400','bg-blue-500','bg-emerald-500');

        if (status === 'Done') {
          badgeEl.classList.add('bg-emerald-50','text-emerald-800','border-emerald-200','ring-emerald-200');
          dot.classList.add('bg-emerald-500');
        } else if (status === 'In progress') {
          badgeEl.classList.add('bg-blue-50','text-blue-800','border-blue-200','ring-blue-200');
          dot.classList.add('bg-blue-500');
        } else {
          badgeEl.classList.add('bg-slate-50','text-slate-800','border-slate-200','ring-slate-200');
          dot.classList.add('bg-slate-400');
        }
        badgeEl.querySelector('.status-text').textContent = status;
        badgeEl.closest('td').dataset.value = status; // for sorting
      }

      function wireRowInteractions(tr) {
        // Default status: Not started
        const badge = tr.querySelector('.status-badge');
        applyStatusStyles(badge, 'Not started');

        
        const menu = tr.querySelector('.status-menu');
        badge.addEventListener('click', (e) => {
          e.stopPropagation();
          document.querySelectorAll('.status-menu').forEach(m => { if (m !== menu) m.classList.add('hidden'); });
          if (menu.classList.contains('hidden')) {
            menu.classList.remove('hidden');
            menu.classList.add('menu-pop');
            setTimeout(() => menu.classList.remove('menu-pop'), 160);
          } else {
            menu.classList.add('hidden');
          }
        });

        // Choose status
        menu.querySelectorAll('.status-option').forEach(btn => {
          btn.addEventListener('click', () => {
            const chosen = btn.dataset.status;
            applyStatusStyles(badge, chosen);
            menu.classList.add('hidden');
            scheduleSave();
          });
        });

        
        tr.querySelector('.delete-row').addEventListener('click', () => {
          tr.classList.add('flash-new');
          setTimeout(() => { tr.remove(); scheduleSave(); }, 160);
        });

        
        const titleDiv = tr.children[0].querySelector('[contenteditable]');
        const notesDiv = tr.children[3].querySelector('[contenteditable]');
        const dueInput = tr.querySelector('.due-input');
        const syncText = () => {
          tr.children[0].dataset.value = titleDiv.textContent.trim().toLowerCase();
          tr.children[3].dataset.value = notesDiv.textContent.trim().toLowerCase();
          scheduleSave();
        };
        const syncDate = () => {
          tr.children[1].dataset.value = dueInput.value || '';
          scheduleSave();
        };
        ['input','blur','keyup','paste'].forEach(evt => {
          titleDiv.addEventListener(evt, syncText);
          notesDiv.addEventListener(evt, syncText);
        });
        dueInput.addEventListener('change', syncDate);
        
        syncText();
        syncDate();
      }

      function addRow(initial = {}) {
        const tr = rowTemplate.content.firstElementChild.cloneNode(true);
        const [titleCell, dueCell, progressCell, notesCell] = tr.children;
        const titleDiv = titleCell.querySelector('[contenteditable]');
        const notesDiv = notesCell.querySelector('[contenteditable]');
        const dueInput = dueCell.querySelector('input');

        if (initial.title) titleDiv.textContent = initial.title;
        if (initial.notes) notesDiv.textContent = initial.notes;
        if (initial.due)   dueInput.value = initial.due; // yyyy-mm-dd

        tbody.appendChild(tr);
        wireRowInteractions(tr);
        
        tr.classList.add('flash-new');
        tr.addEventListener('animationend', () => tr.classList.remove('flash-new'), { once: true });
        scheduleSave();
        return tr;
      }

      function compareByType(aVal, bVal, type) {
        // only text comparison remains; progress sorting removed
        return aVal.localeCompare(bVal);
      }

      function sortRows(key, type, direction) {
        const rows = Array.from(tbody.querySelectorAll('tr'));
        rows.sort((rowA, rowB) => {
          const map = { title: 0, due: 1, progress: 2, notes: 3 };
          const aVal = rowA.children[map[key]].dataset.value || '';
          const bVal = rowB.children[map[key]].dataset.value || '';
          if (type === 'date') {
            
            const aEmpty = !aVal;
            const bEmpty = !bVal;
            if (aEmpty && bEmpty) return 0;
            if (aEmpty) return 1; // a goes after b
            if (bEmpty) return -1; // b goes after a
            const aTs = new Date(aVal).getTime();
            const bTs = new Date(bVal).getTime();
            return direction === 'asc' ? aTs - bTs : bTs - aTs;
          }
          const cmp = compareByType(aVal, bVal, type);
          return direction === 'asc' ? cmp : -cmp;
        });
        rows.forEach(r => tbody.appendChild(r));
      }

      function resetIndicators(exceptBtn) {
        document.querySelectorAll('.sort-header').forEach(btn => {
          if (btn !== exceptBtn) {
            btn.dataset.direction = '';
            btn.querySelector('.sort-indicator').textContent = '↕';
          }
        });
      }

      // Sorting handlers
      document.querySelectorAll('.sort-header').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.dataset.key;
          const type = btn.dataset.type;
          const current = btn.dataset.direction || 'none';
          const next = current === 'asc' ? 'desc' : 'asc';
          btn.dataset.direction = next;
          
          if (type === 'date') {
            btn.querySelector('.sort-indicator').textContent = next === 'asc' ? 'Oldest' : 'Newest';
          } else {
            btn.querySelector('.sort-indicator').textContent = next === 'asc' ? '↑' : '↓';
          }
          resetIndicators(btn);
          sortRows(key, type, next);
        });
      });

      // Add row buttons
      document.getElementById('addRowBtn').addEventListener('click', () => addRow());
      document.getElementById('fabAdd').addEventListener('click', () => addRow());
      document.getElementById('addRowInline').addEventListener('click', () => addRow());

      // Close any open status menus when clicking outside
      document.addEventListener('click', () => {
        document.querySelectorAll('.status-menu').forEach(m => m.classList.add('hidden'));
      });

      
      const saved = readTasksFromStorage();
      if (saved && saved.length) {
        restoreFromData(saved);
      } else {
        addRow({ title: 'Find your perfect partner', due: '2000-09-02', notes: "Change the formatting of 'Done' items under the menu..." });
        const r2 = addRow({ title: 'Start entering guest list' });
        
        (function markInitialStatuses(){
          const rows = tbody.querySelectorAll('tr');
          const first = rows[0];
          const second = rows[1];
          if (first) {
            applyStatusStyles(first.querySelector('.status-badge'), 'Done');
          }
          if (second) {
            applyStatusStyles(second.querySelector('.status-badge'), 'In progress');
          }
        })();
        saveTasksToStorage();
      }

      
      const searchInput = document.getElementById('searchInput');
      const statusFilter = document.getElementById('statusFilter');

      function applyFilters() {
        const q = (searchInput.value || '').trim().toLowerCase();
        const filter = statusFilter.value;
        tbody.querySelectorAll('tr').forEach(tr => {
          const title = tr.children[0].innerText.toLowerCase();
          const notes = tr.children[3].innerText.toLowerCase();
          const status = tr.children[2].dataset.value;
          const matchesSearch = !q || title.includes(q) || notes.includes(q);
          const matchesStatus = filter === 'all' || status === filter;
          tr.style.display = matchesSearch && matchesStatus ? '' : 'none';
        });
      }

      searchInput.addEventListener('input', applyFilters);
      statusFilter.addEventListener('change', applyFilters);

      
    </script>
  </body>
  </html>


